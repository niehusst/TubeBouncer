{"version":3,"file":"options_bundle.js","sources":["../src/store.js","../src/options.js","../src/options_main.js"],"sourcesContent":[" \n\n/* DATA STORAGE EXPLANATION:\n *\n * 3 separate data bits stored in local storage.\n * DATE_STORAGE_KEY is a map from urlKey to a date string of the\n * last day the urlKey was visited.\n *\n * START_TIME_STORAGE_KEY is a map from urlKey to a list of\n * watch-session start times as unix timestamps.\n * Ordered in chronological order. Corresponds to and end time\n * by matching index; together the 2 values form a time diff pair\n * representing the length of the watch-session.\n *\n * END_TIME_STORAGE_KEY is a map from urlKey to a list of\n * watch-session end times as unix timestamps.\n * Ordered in chronological order. Latest end timestamp will\n * be updated in place repeated until watch-session stagnates.\n * MUST BE SAME LENGTH AS LISTS IN START_TIME_STORAGE_KEY\n */\n\n// TODO: just consolidate this shit into 1 object\n\n// date_key: {urlKey: <date>, ...}\nexport const DATE_STORAGE_KEY = \"date_key\";\nexport const START_TIME_STORAGE_KEY = \"start_key\"; \nexport const END_TIME_STORAGE_KEY = \"end_key\";\nexport const MAX_WATCH_TIME_MS = 1000 * 60 * 60; // 1h\n\nexport async function readValue(key, browser) {\n  const savedValue = await browser.storage.local.get(key);\n  return savedValue[key];\n}\n\nexport async function writeValue(key, value, browser) {\n  await browser.storage.local.set({\n    [key]: value,\n  });\n}\n\nexport async function latestStartTime(urlKey, browser) {\n  const startTimeList = await readValue(START_TIME_STORAGE_KEY, browser);\n  if (startTimeList && startTimeList[urlKey]) {\n    return startTimeList[urlKey][startTimeList[urlKey].length - 1];\n  }\n  return undefined;\n}\n\nexport async function latestEndTime(urlKey, browser) {\n  const endTimeList = await readValue(END_TIME_STORAGE_KEY, browser);\n  if (endTimeList && endTimeList[urlKey]) {\n    return endTimeList[urlKey][endTimeList[urlKey].length - 1];\n  }\n  return undefined;\n}\n\nexport async function sumWatchTime(urlKey, browser) {\n  const startTimeMap = (await readValue(START_TIME_STORAGE_KEY, browser)) ?? {};\n  const startTimeList = startTimeMap[urlKey] ?? [];\n  const endTimeMap = (await readValue(END_TIME_STORAGE_KEY, browser)) ?? {};\n  const endTimeList = endTimeMap[urlKey] ?? [];\n\n  if (startTimeList.length !== endTimeList.length) {\n    console.error('watch list len mismatch');\n    return 0;\n  }\n  let sum = 0;\n  for (let i = 0; i < startTimeList.length; i++) {\n    sum += endTimeList[i] - startTimeList[i];\n  }\n  return sum;\n}\n\nexport function getCurrentDate() {\n  const d = new Date();\n  return `${d.getMonth()+1}-${d.getDate()}-${d.getFullYear()}`;\n}\n","import {\n  DATE_STORAGE_KEY,\n  START_TIME_STORAGE_KEY,\n  END_TIME_STORAGE_KEY,\n  MAX_WATCH_TIME_MS,\n  readValue,\n  sumWatchTime\n} from './store.js';\n\nexport async function getRemainingWatchTime(urlKey, browser) {\n  // bound watch time between 0 and MAX_WATCH_TIME_MS\n  let timeWatchedMs = await sumWatchTime(urlKey, browser);\n  timeWatchedMs = isNaN(timeWatchedMs) ? 0 : timeWatchedMs;\n  timeWatchedMs = Math.min(Math.max(timeWatchedMs, 0), MAX_WATCH_TIME_MS);\n  let watchTimeLeftMinutes = (MAX_WATCH_TIME_MS - timeWatchedMs) / (1000 * 60);\n  // allow only 2 decimal places\n  watchTimeLeftMinutes = Math.trunc(watchTimeLeftMinutes * 100) / 100;\n  return watchTimeLeftMinutes;\n}\n\nexport async function getInfo(browser) {\n  const dayMap = await readValue(DATE_STORAGE_KEY, browser);\n  const endTimeList = await readValue(END_TIME_STORAGE_KEY, browser);\n  const startTimeList = await readValue(START_TIME_STORAGE_KEY, browser);\n  const infoList = [\n    `days: ${JSON.stringify(dayMap)}`,\n    `starts ms: ${JSON.stringify(startTimeList)}`,\n    `ends ms: ${JSON.stringify(endTimeList)}`,\n  ]\n  return infoList.join('\\n');\n}\n\nexport async function optMain({browser, document}) {\n  const naKey = \"none\";\n  document.getElementById(naKey)?.remove();\n\n  const dayMap = (await readValue(DATE_STORAGE_KEY, browser)) || {};\n  const sites = Object.keys(dayMap);\n  const body = document.getElementsByTagName(\"body\")[0];\n  const hasVisitedSites = sites.length > 0;\n  const hasPageUI = body.children.length > 0;\n  // elements w/ dynamicLabel class marker have id w/ pattern \"site_key::info_type\"\n  const dynamicLabel = 'dyn';\n  const day = 'day';\n  const watched = 'watched';\n  const info = 'info';\n\n  if (!hasVisitedSites && !hasPageUI) {\n    // <div id=\"${naKey}\"><h2>Haven't watched any sites yet</h2></div>\n    const div = document.createElement('div');\n    div.id = naKey;\n    const h2 = document.createElement('h2');\n    h2.textContent = \"Haven't watched any sites yet\";\n    div.appendChild(h2);\n    body.appendChild(div);\n  } else if (hasVisitedSites && !hasPageUI) {\n    // add elements for first time\n    for (let key of sites) {\n      // <div id=${key}></div>\n      const elemGroup = document.createElement('div');\n      elemGroup.id = key;\n      body.appendChild(elemGroup);\n\n      const watchTimeLeftMinutes = await getRemainingWatchTime(key, browser);\n\n      // <p>Last watched ${key} on:</p>\n      const p1 = document.createElement('p');\n      p1.textContent = `Last watched ${key} on:`;\n      elemGroup.appendChild(p1);\n\n      // <h2 id=\"${key}::${day}\" class=\"${dynamicLabel}\">${dayMap[key]}</h2>\n      const h2day = document.createElement('h2');\n      h2day.id = `${key}::${day}`;\n      h2day.className = dynamicLabel;\n      h2day.textContent = dayMap[key];\n      elemGroup.appendChild(h2day);\n\n      // <p>Minutes left in day to watch:</p>\n      const p2 = document.createElement('p');\n      p2.textContent = 'Minutes left in day to watch:';\n      elemGroup.appendChild(p2);\n\n      // <h2 id=\"${key}::${watched}\" class=\"${dynamicLabel}\">${watchTimeLeftMinutes}</h2>\n      const h2watched = document.createElement('h2');\n      h2watched.id = `${key}::${watched}`;\n      h2watched.className = dynamicLabel;\n      h2watched.textContent = watchTimeLeftMinutes;\n      elemGroup.appendChild(h2watched);\n    }\n\n    const btnId = 'btn';\n    const ddId = `dd::${info}`;\n    const infoData = await getInfo(browser);\n\n    // <button id=\"${btnId}\">(debug info)</button>\n    const btn = document.createElement('button');\n    btn.id = btnId;\n    btn.textContent = '(debug info)';\n    body.appendChild(btn);\n\n    // <p class=\"small gone ${dynamicLabel}\" id=\"${ddId}\">${infoData}</p>\n    const pInfo = document.createElement('p');\n    pInfo.className = `small gone ${dynamicLabel}`;\n    pInfo.id = ddId;\n    pInfo.textContent = infoData;\n    body.appendChild(pInfo);\n\n    btn.addEventListener('click', function () {\n      const content = document.getElementById(ddId);\n      if (content.style.display === \"none\" || content.style.display === \"\") {\n        content.style.display = \"block\";\n      } else {\n        content.style.display = \"none\";\n      }\n    });\n  } else if (hasVisitedSites && hasPageUI) {\n    // update in place\n    const elemsToUpdate = document.getElementsByClassName(dynamicLabel);\n    for (let elem of elemsToUpdate) {\n      const [key, action] = elem.id.split('::');\n      switch (action) {\n        case info:\n          elem.innerText = await getInfo(browser);\n          break;\n        case day:\n          elem.innerText = dayMap[key];\n          break;\n        case watched:\n          elem.innerText = await getRemainingWatchTime(key, browser);\n          break;\n        default:\n          console.error(\"bad action:\", action);\n          break;\n      }\n    }\n  }\n}\n\n","import { optMain } from './options.js';\n\noptMain({browser, document});\nsetInterval(() => {\n  optMain({browser, document});\n}, 5000);\n\n\n"],"names":[],"mappings":"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"}